<!DOCTYPE html>

<html>
<head>
  <title>example-server.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>example-server.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*global __dirname:false require:false*/</span>
<span class="hljs-comment">/*jshint strict:false unused:true smarttabs:true eqeqeq:true immed: true undef:true*/</span>
<span class="hljs-comment">/*jshint maxparams:7 maxcomplexity:7 maxlen:150 devel:true newcap:false*/</span> 

<span class="hljs-keyword">var</span> server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./lib/bb-server.js'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>testMail = require(“./testSendMail”),
testGet = require(“./testGet”)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO: limit sending of files to certain mimetypes and/or extensions
TODO: option to not send mimeless files found in allowable directories.
TODO: send certain files directly, bypassing cache with certain
cache control headings, so we can send big files etc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> options = {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Serve all files relative to this root. Defaults to ‘./‘.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    root: <span class="hljs-string">'/home/michieljoris/www/sites/firstdoor/www'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>if not assigned defaults to 8080. If that port’s not available
the server will try 8081 and so on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,port: <span class="hljs-number">9000</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Assign true to allow listing of directories when the path in
the url matches a path on the server relative to the
root. Assign an array of paths to limit listing to the listed
paths (relative to the root) eg. [‘/lib’]. Defaults to true. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,dir: <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If index.html is found in an allowable directory it is sent
over instead of the directory listing. Assign a string to look
for and send a different default file. Defaults to false and to
‘index.html’ if assigned true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,index: <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>if a request for /favicon comes in send the favicon found in the
path specified (relative to where this script is executed from), 
with a cache control setting of maxAge (in [m]inutes, [h]ours,
[d]ays, [w]eeks or [y]ears). Defaults to the favicon.ico bundled
with the server with a max age of 1 hour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,favicon: {
        path:  <span class="hljs-string">'./favicon.ico'</span>,
        maxAge: <span class="hljs-string">'1h'</span> 
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>see lib/logger.js for more info. Basically logging all requests to a file.
,log: true</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,log: {
        <span class="hljs-string">'format'</span>: <span class="hljs-string">'dev'</span>,  <span class="hljs-comment">//Format string: default, short, tiny, dev, or custom token string</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>‘stream’: ‘mylog.txt’,  //Output stream, defaults to <em>stdout</em>
‘buffer’: ‘’, //Buffer duration, defaults to 1000ms when <em>true</em></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">'immediate'</span>: <span class="hljs-string">''</span>  <span class="hljs-comment">//Write log line on request instead of response (false for response times)</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>silence (debug) output on the commandline</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,<span class="hljs-string">"quiet"</span>: <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>control caching of resources in terms of what cache-control headers are
sent out with them and how long resources are kept in the server cache. If
true defaults to ((m)inutes, (h)ours, (d)ays, (w)weeks, (y)ears):
,cache: true </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,cache: {
        stamped: { expiresIn: <span class="hljs-string">'1y'</span> },
        prerender: { expiresIn: <span class="hljs-string">'1d'</span>},</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>static resources, should be served from cookieless domain:</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>“css js jpg jpeg gif ico png bmp pict csv doc pdf pls ppt tif tiff eps swf”: { expiresIn: “1d” },
“midi mid ttf eot woff svg svgz webp docx xlsx xls pptx ps” : { expiresIn: “1d” },
but possibly not when going through cloudflare:
<a href="https://support.cloudflare.com/hc/en-us/articles/200169816-Can-I-serve-a-cookieless-domain-or-subdomain-through-CloudFlare-">https://support.cloudflare.com/hc/en-us/articles/200169816-Can-I-serve-a-cookieless-domain-or-subdomain-through-CloudFlare-</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"pdf doc docx"</span>: { expiresIn: <span class="hljs-string">"2h"</span> },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>docs: { expiresIn: ‘1d’, ext: [‘pdf’,’doc’,’docx’] },</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        other: { expiresIn: <span class="hljs-string">'0m'</span>}
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>if set to true to the server will try to remove a stamp from request paths
before processing them. This also enables cache control for the response
to these requests. See previous options.
Defaults to false.  ,
,stamp: false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,stamp: {
        prefix: <span class="hljs-string">'__'</span> <span class="hljs-comment">// or for example: 'stamp-'</span>
        ,length: <span class="hljs-number">10</span>  <span class="hljs-comment">//32 for md5 and 40 for sha1, but set to 10 by default</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>set length to 13 if you use mtime create the stamp for a resource
if 10 is not long enough, in other words, if a resource is not
updated and stays cached, up the length property by 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>files can be transformed (recast) before being sent to the
client. If the cache is turned on this will only happen the
first time the file is requested. After that the recast file
will be sent from the cache. Only when the mtime of the
original file is more recent that the date of the cached
version the recasting is done again. 
recaster is a separate module and can easily be expanded to
include more transpilers, minifiers and zippers.</p>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>toggle the following three options to true to enable recasting,
all three default to false:</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>,transpile: false 
,minify: true //html, js and css
,zip: true //compress when enconding is accepted by client
or for more finegrained control define the recast option instead:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,recast: {
        transpile: [<span class="hljs-string">'jade'</span>, <span class="hljs-string">'less'</span>, <span class="hljs-string">'stylus'</span>, <span class="hljs-string">'sweetjs'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>‘typescript’, ‘coffeescript’,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-string">'markdown'</span>,
                    <span class="hljs-string">'denodify'</span>,
                    <span class="hljs-string">'regenerators'</span>
                   ],</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>transpile: [],  //TODO add all current supported file types</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>minify: [],</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        minify: [<span class="hljs-string">'js'</span>, <span class="hljs-string">'css'</span> ] <span class="hljs-comment">//js, css, html</span>
        ,zip: <span class="hljs-regexp">/text|javascript|json/</span> <span class="hljs-comment">//regex on the mimetype</span>
        ,verbose: <span class="hljs-literal">true</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>if spa is true all requests that don’t seem to be requests for a file with
a mimetype are redirected to a request for just one file. By default this
is index.html, but a different filename can get assigned to spa. Use a
fragment meta tag in your spa file, or use hashbang in your urls to have
google crawl <em>escaped_fragment</em> urls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,spa: <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>the server can prerender requests for <em>escaped_fragment</em> urls. For any
prerendering to occur the following option needs to be true. Defaults to
false. If set to true, better turn on caching as well, otherwise it will
try to prerender the page for every <em>escaped_fragment</em> request, Also
either enable phantomPath or seoServer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,prerender:<span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>specify a path for phantomjs or set it to truthy. In the last case the
server will use the phantomjs module’s path or as a last resort
‘phantomjs’. If falsy, or the phantomjs executable is not found, the
seoServer will be called upon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,phantomPath: <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>if phantomPath is not valid the server will call on the external
seoServer. Assign an url. Defaults to false. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,seoServer: <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>forward requests with a certain prefix in the path to another server
“forward”: [
    { “prefix”: “local”,
      “target”: “<a href="http://localhost:5984">http://localhost:5984</a>“ },
    { “prefix”: “iris”,
      “target”: “<a href="https://somedb.iriscouch.com&quot;}">https://somedb.iriscouch.com&quot;}</a>
]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    
    ,postHandlers: {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>“/“ : save
“/contactus_form” : sendMail
,”/contactus_form” : testSendMail</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
    ,getHandlers: {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>“/sync”: sync,
“/dropbox_authorize”: dropbox_authorize,
“/dropbox_connect”: dropbox_connect</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If method and path match the functin will be called with [req, res].
,postHandlers: {
    “/testPost” : testPost
}
If method and path match the function will be called with [req, res].
,getHandlers: {
    “/testget” : testGet,
}
needs testing:
start a https server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,https: <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>start a websocket server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,wsServer: <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>attaches session data to requests
,sessions: {
    expires: 30
    // ,store: ‘mysql’
    ,store: ‘memory’
    // ,storeOpts: {
    //     //options for mysql, memory doesn’t need any
    // }
}
}
not implemented yet:
server api path:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,api: <span class="hljs-string">'_api'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>use persona to authenticate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,persona: <span class="hljs-literal">true</span>
    ,emails: [<span class="hljs-string">'mail@axion5.net'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>enable server api:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    ,sitemap: <span class="hljs-literal">true</span>
    ,html_builder: <span class="hljs-literal">true</span>
    ,clear_cache: <span class="hljs-literal">true</span>
    ,files: <span class="hljs-literal">true</span>
    ,stats: <span class="hljs-literal">true</span>
};

server.go(options);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
